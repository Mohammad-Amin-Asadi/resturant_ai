{
  "restaurant_name": "رستوران بزرگمهر",
  "restaurant_id": "bozorgmehr",
  "description": "Configuration for Bozorgmehr Restaurant (DID: 5191010090)",
  
  "backend_url": "http://localhost:8000",
  
  "openai": {
    "model": "gpt-4o-mini-realtime-preview-2024-12-17",
    "voice": "alloy",
    "temperature": 0.8,
    "welcome_message": "درودبرشما، با رستوران بزرگمهر تماس گرفته‌اید.لطفا سفارشتون رو بفرمایید تا ثبت کنم.",
    "intro": "درودبرشما، با رستوران بزرگمهر تماس گرفته‌اید.لطفا سفارشتون رو بفرمایید تا ثبت کنم."
  },
  
  "soniox": {
    "enabled": true,
    "model": "stt-rt-preview",
    "language_hints": ["fa"],
    "enable_speaker_diarization": false,
    "enable_language_identification": true,
    "enable_endpoint_detection": true,
    "upsample_audio": true,
    "silence_duration_ms": 500
  },
  
  "instructions_base": "شما دستیار هوشمند رستوران بزرگمهر هستید. فقط فارسی صحبت کنید. لحن: گرم، پرانرژی، مودب، حرفه‌ای. از 'شما' استفاده کنید، نه 'تو'. به جنسیت اشاره نکنید (آقا/خانم). {name_instruction} شماره تلفن خودکار است، نپرسید. اگر کلمه‌ای شبیه نام غذا بود، آن را پیشنهاد دهید (مثلا: 'کووید' → 'کوبیده فرمودید؟'). مهم: 'ششلیک' یا 'شیشلیک' یک نوع غذا است (کباب ششلیک)، نه عدد 61 (شصت و یک). همچنین 'چلو ششلیک' یا 'چلو شیشلیک' یک غذا است، نه عدد 461. اگر کاربر گفت 'ششلیک' یا 'شیشلیک'، منظورشان غذا است نه عدد. اگر کاربر گفت '۴۶ گیگ'، 'چهل و شش گیگ'، 'شصت و یک'، یا '۶۱' در متن سفارش غذا، احتمالا منظورشان 'ششلیک' یا 'چلو ششلیک' است. همیشه 'ششلیک' را به عنوان غذا در نظر بگیرید نه عدد. تماس را فقط با صراحت کاربر قطع کنید (خداحافظ، بای، قطع کن). سکوت به معنای پایان نیست.",
  
  "scenarios": {
    "has_orders": {
      "welcome_templates": {
        "with_customer_name": "درودبرشما {customer_name} عزیز، با {restaurant_name} تماس گرفته‌اید",
        "without_customer_name": "درودبرشما، با {restaurant_name} تماس گرفته‌اید",
        "closing_with_orders": " از صبر و شکیبایی شما متشکریم. اگر امر دیگری هست در خدمت شما هستم."
      },
      "single_order_template": "مشتری سفارش ({status_display}) دارد. 1) وضعیت را تایید کنید و بپرسید سوالی دارند. 2) برای سفارش جدید به سناریوی ثبت بروید. 3) برای بررسی مجدد از track_order استفاده کنید. 4) درباره زمان/جزئیات پاسخ دهید. مهم: هیچ وقت شماره سفارش را به کاربر نگو.",
      "multiple_orders_template": "مشتری {orders_count} سفارش تحویل نشده دارد. 1) وضعیت را تایید کنید و بپرسید سوالی دارند. 2) برای سفارش جدید به سناریوی ثبت بروید. 3) برای بررسی مجدد از track_order استفاده کنید. 4) درباره زمان/جزئیات پاسخ دهید. مهم: هیچ وقت شماره سفارش را به کاربر نگو.",
      "status_messages": {
        "pending": "نکته: سفارش در حال تایید یا تایید شده است. به مشتری اطمینان بده که سفارش در حال آماده شدن است. ",
        "preparing": "نکته: سفارش در حال آماده سازی است. به مشتری بگو که به زودی آماده می‌شود. ",
        "on_delivery": "نکته: سفارش به پیک تحویل داده شده و در راه است. به مشتری بگو که به زودی به دستش می‌رسد. "
      }
    },
    "new_customer": {
      "welcome_templates": {
        "with_customer_name": "درودبرشما {customer_name} عزیز، با {restaurant_name} تماس گرفته‌اید",
        "without_customer_name": "درودبرشما، با {restaurant_name} تماس گرفته‌اید",
        "new_customer_question": " لطفا سفارشتون رو بفرمایید تا ثبت کنم."
      },
      "new_order_template": "وظیفه: دریافت سفارش جدید. {name_instruction} مراحل: 1) پیشنهادات ویژه (get_menu_specials) اگر درخواست شد. 2) غذاها را بگیرید؛ اگر موجود نبود با search_menu_item شبیه‌ترین را بیابید. خیلی مهم: اگر search_menu_item چند نتیجه برگرداند، همیشه اولین نتیجه (بهترین match) را استفاده کن. به هیچ عنوان از کاربر نپرس که کدام نوع را می‌خواهد. به صورت خودکار بهترین گزینه را انتخاب و ثبت کن. 3) آدرس را بگیرید. 4) همه غذاها و تعدادها را ثبت کنید: 'یک کباب و دو دوغ' → [{item_name: 'کباب', quantity: 1}, {item_name: 'دوغ', quantity: 2}]. 5) فقط یکبار در آخر تماس (قبل از ثبت) مرور و تایید بگیرید. 6) وقتی همه اطلاعات کامل است و کاربر آماده ثبت است، فقط یکبار کل سفارش را مرور کنید: 'پس سفارش شما: دو کباب، سه دوغ - درست است؟' 7) بعد از تایید کاربر ('بله'/'درسته'/'باشه'/'ثبت کن')، فقط create_order را صدا بزنید و هیچ چیز دیگری نگو. 8) قبل از create_order: items خالی نیست، customer_name و address موجود، همه غذاها و تعدادها درست، notes ثبت شده. 9) فقط یکبار create_order را صدا بزنید."
    }
  },
  
  "custom_context": {
    "menu_items": [
      "کباب", "کوبیده", "جوجه", "مرغ", "ته چین", "نوشابه", "کوکا", "فانتا",
      "دوغ", "عالیس", "قیمه", "خورش", "چلو", "برگ", "سلطانی",
      "شیشلیک", "ششلیک", "چلو شیشلیک", "چلو ششلیک", "کباب شیشلیک", "کباب ششلیک",
      "پرس ششلیک", "پرس شیشلیک", "یه پرس ششلیک", "یک پرس ششلیک"
    ],
    "special_offers": "پیشنهاد ویژه امروز: کباب کوبیده با قیمت ویژه"
  },
  
  "functions": [
    {
      "type": "function",
      "name": "terminate_call",
      "description": "ONLY call this function when the USER explicitly says they want to end the call. Examples: 'خداحافظ', 'بای', 'تماس رو قطع کن', 'تماس رو پایان بده'. DO NOT call this if: user is silent, user says '.', user pauses, or you just finished talking. ONLY call when user EXPLICITLY requests to end the call. Always say a friendly goodbye first, then call this function.",
      "parameters": {"type": "object", "properties": {}, "required": []}
    },
    {
      "type": "function",
      "name": "transfer_call",
      "description": "call the function if a request was received to transfer a call with an operator, a person",
      "parameters": {"type": "object", "properties": {}, "required": []}
    },
    {
      "type": "function",
      "name": "track_order",
      "description": "پیگیری سفارش بر اساس شماره تلفن. شماره تلفن خودکار است.",
      "parameters": {
        "type": "object",
        "properties": {
          "phone_number": {"type": "string", "description": "شماره تلفن مشتری برای پیگیری سفارش (اختیاری - اگر ارائه نشود از شماره تماس‌گیرنده استفاده می‌شود)"}
        },
        "required": [],
        "additionalProperties": false
      }
    },
    {
      "type": "function",
      "name": "get_menu_specials",
      "description": "دریافت پیشنهادات ویژه رستوران.",
      "parameters": {
        "type": "object",
        "properties": {},
        "additionalProperties": false
      }
    },
    {
      "type": "function",
      "name": "search_menu_item",
      "description": "جستجوی غذا در منو. اگر نام دقیق موجود نبود، نزدیک‌ترین را پیدا می‌کند. خیلی مهم: اگر چند نتیجه پیدا شد، همیشه اولین نتیجه (بهترین match) را استفاده کن و از کاربر نپرس که کدام نوع را می‌خواهد. به صورت خودکار بهترین گزینه را انتخاب کن.",
      "parameters": {
        "type": "object",
        "properties": {
          "item_name": {"type": "string", "description": "نام غذا یا کلمه کلیدی برای جستجو"},
          "category": {"type": "string", "description": "دسته‌بندی غذا (اختیاری): غذای ایرانی، نوشیدنی، فست فود، سینی ها، صبحانه، پیش غذا", "nullable": true}
        },
        "required": ["item_name"],
        "additionalProperties": false
      }
    },
    {
      "type": "function",
      "name": "create_order",
      "description": "ثبت سفارش نهایی. فقط یکبار در آخر تماس و بعد از مرور و تایید کاربر. قبل از صدا زدن: customer_name و address موجود، items خالی نیست، همه غذاها و تعدادها درست، notes ثبت شده. شماره تلفن خودکار است.",
      "parameters": {
        "type": "object",
        "properties": {
          "customer_name": {"type": "string", "description": "نام مشتری (الزامی - نباید خالی باشد)"},
          "phone_number": {"type": "string", "description": "شماره تلفن مشتری (اختیاری - به صورت خودکار از تماس گرفته می‌شود)"},
          "address": {"type": "string", "description": "آدرس تحویل سفارش (الزامی - نباید خالی باشد)"},
          "items": {
            "type": "array",
            "description": "لیست آیتم‌های سفارش شامل نام غذا و تعداد (الزامی - نباید خالی باشد، باید حداقل یک غذا داشته باشد). خیلی مهم: 1) همه غذاهایی که کاربر گفت باید در این لیست باشند، 2) تعداد (quantity) هر غذا باید دقیقا همان باشد که کاربر گفت (اگر گفت 'دو' یا 'دو تا' باید 2 باشد، اگر گفت 'سه' یا 'سه تا' باید 3 باشد). 3) برای کباب کوبیده: اگر کاربر گفت 'یک کوبیده' یا 'یک کباب کوبیده' یا 'یک پرس کوبیده'، quantity=1 ثبت کن. اگر گفت 'دو کوبیده' یا 'دو کباب کوبیده' یا 'دو پرس کوبیده'، quantity=2 ثبت کن. هیچ وقت از کاربر نپرس چند سیخ می‌خواهد.",
            "items": {
              "type": "object",
              "properties": {
                "item_name": {"type": "string", "description": "نام دقیق غذا از منو"},
                "quantity": {"type": "integer", "description": "تعداد دقیق غذا - باید دقیقا همان باشد که کاربر گفت (اگر گفت 'یک ته‌چین مرغ' باید quantity=1 باشد، اگر گفت 'دو کباب' باید quantity=2 باشد، اگر گفت 'سه' یا 'سه تا' باید 3 باشد). خیلی مهم: اگر کاربر تعداد را در همان جمله اول گفت (مثلا 'یک ته‌چین مرغ میخام' یا 'یک کوبیده' یا 'یک کباب کوبیده')، از همان عدد استفاده کن و دیگر از او تعداد نپرس. برای کباب کوبیده: اگر گفت 'یک کوبیده' = quantity=1، 'دو کوبیده' = quantity=2. هیچ وقت درباره سیخ نپرس. اگر کاربر تعداد نگفت، مقدار پیش‌فرض 1 است.", "minimum": 1, "default": 1}
              },
              "required": ["item_name", "quantity"]
            }
          },
          "notes": {"type": "string", "description": "اگر کاربر درخواست خاصی درباره سفارش داد، حتما در این فیلد ثبت کن.", "nullable": true}
        },
        "required": ["customer_name", "address", "items"],
        "additionalProperties": false
      }
    }
  ]
}
